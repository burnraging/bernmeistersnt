                                
								Usx-gen Instructions
=====================================================================================

Overview
--------
Nearby is a software tool called "usx-gen." It converts a specially-formatted
file called "the-bernmeisters-new-testament-DESTRUCTIVE-COPY.txt" into USX
formatted output(s).

"the-bernmeisters-new-testament-DESTRUCTIVE-COPY.txt" is generated by first copying
"the-bernmeisters-new-testament.docx" to a file called "the-bernmeisters-new-testament-DESTRUCTIVE-COPY.docx"
This is done to protect "the-bernmeisters-new-testament.docx" from destructive edits.
After the destructive edits are made in MS Word to the-bernmeisters-new-testament-DESTRUCTIVE-COPY.docx,
it is saved as a text file. The tool usx-gen uses this as an input and produces
output files in USX format.

Usx-gen can/does generate two versions of outputs. These are the unabridged and the abridged
versions. The abridged version is the default version. It is the same as the unabridged
version except that the introduction sections of each book have been removed and all the
footnotes also. In addition, the abridged version removes all italics formatting.
The unabridged version is for the reader wants to have the italicized text and the footnote
references in the verseion he or she reads, in addition to the introductions.


Compiling and Running Usx-gen
-----------------------------
Usx-gen is a C# console app which can/is run in debug mode. It was built and run 
in Windows, using the MS Visual Studio Community Edition, which MS allows users to download
and use without cost.

In addition to generating the output files, usx-gen produces these intermediate files:

1) scanner-out.txt
2) processed-out-unabridged.txt
3) processed-out-abridged.txt

Usx-gen's first stage is to take the destructive text file ("the-bernmeisters-new-testament-DESTRUCTIVE-COPY.txt")
as an input and created internal structures which concatenate the contiguous occurences of marked up
text (such as superscripts and italics) and turns them into its own internal markup forms. The results
of this is written to "scanner-out.txt", a file which is common between the unabridged and
abridged versions. This first stage output file reflects what's stored in internal objects
in the C# code. These objects will contain the paragraph formatting and the character formatting
of the text file saved from Word.

The second stage of usx-gen is to convert the internal objects created in the first stage
into another set of internal objects/members of existing object. These second stage objects
are parsed versions of the verse numbers and footnotes. Again, these second stage results
are written to files, one for the unabridged ("processed-out-unabridged.txt") and one
for the abridged ("processed-out-abridged.txt").

The third usx-stage is to take the second stage results and write the actual XML
for the USFX output files. USFX stores its Bibles in one file per book, so there'll be
multiple files for each version, with there being two versions. To make the XML output
files more readable, verses which are long are broken into several lines,
rather than crowding a single verse into a very long line of output (which is legal
from an XML perspective). The sets of files for each version are then written to
their own folders.

I create the supplemental files "scanner-out.txt", "processed-out-unabridged.txt",
and "processed-out-abridged.txt" to assist in pinpointing and debugging problems.
Furthermore, I print informational messages to the console. If an informational messages
ends in an exclamation point, often time it's a fatal error. Many of the console
messages are things which need to be fixed in the .docx source. They may be things
that usx-gen knows are a problem and result in erroneous conversion. Or it may
result in a crash or fatal error in a subsequent processing stage. In either case,
it is usx-gen telling the user to investigate something. Having said all that, the
console messages are certainly not perfect, and there are issues which can be ignored.
Usx-gen is an incomplete tool, and some of the corners which have been cut
show up in spurious "noise" console messages.

Conversion strategy
-------------------
Strategic search & replaces are done to a copy of the Word source document.
"Strategic search & replace" uses advanced search features of Word to insert
unique (assumes not used anywhere in document) character combinations to specify
paragraph formatting and letter formatting. For example, all characters formatted
as italics have a special sequence inserted before them. Though this makes the
text file output visually unappealing, usx-gen needs this info.

When saving the file as a text, care must be taken NOT to save it as an ASCII
format but to save it as a UTF-8 file. If this isn't done, lots of valuable
information will be lost or corrupted, such as whether starting and ending
double-quotes are properly preserved, apostrophes, Greek letters, etc.

I cannot emphasize this enough:

    COPY YOUR MS WORD BIBLE DOCUMENT ("the-bernmeisters-new-testament.docx") TO
    ANOTHER FILE FIRST!!! DO NOT APPLY THE EDITS SPECIFIED BELOW DIRECTLY TO
    "the-bernmeisters-new-testament.docx". ONLY APPLY THEM TO THE COPY,
	WHICH WILL BE DESTROYED!


MS Word Doc Formatting Rules
----------------------------
Usx-gen assumes the following in order to order for it to work:

- Heading1 style must have book name
- Depending on settings, Heading2 style must have chapter name or be the introduction section
- Introduction sections must be first Heading2 in book
- Footnotes are distinguished from verse text by use of a blank line
  formatted with the "spacer-before-footnotes" style
- Verse numbers must be superscripted
- Titles within the body of the chapter text aren't supported.
  They are assumed to be a part of the verse itself.
- The first character in any chapter must be a "1" specifying verse 1
- Although verse numbers can be missing, they must increase in number in the chapter
- Footnotes (if making an unabridged version) are of form [a], where 'a' is a single
  or double letter wrapped in brackets.
- Footnote letters are superscripted
- Footnote letters are case-sensitive
- Footnote letters must be unique in the footnote section, but may be referenced
  multiple times in the chapter text.
- Footnotes must use "footnotes-normal" style

Settings
--------
You can change file and folder names by making changes to 'Settings.cs'
Should you want to use usx-gen on your own Bible source docx, there are other settings
you'll want to change as well. See comments in that file.

Search & Replace Chart
----------------------
The following is the chart for search and replace texts and step-by-step
instructions how to do this in MS Word.

Inside of MS Word, there's a feature that allows you to assign a name
to a style. Usx-gen assumes the Word source uses Styles that have been assigned
names corresponding to what's listed below here. Of course, you can change
the usx-gen C# code to specify different style names, but keep in mind
that the ultimate goal is to generate XML attributes which exercise the
paragraph formatting which USFX offers. So, one would have to not only
change the style names but also change the XML generation code, to specify
other formatting. This is not as difficult as it might sound.

> Formatting (all styles)
%i@    Italics
%u@    Superscript
%d@    Subscript  (none currently exist: skip)
%b@    Bold (none currently exist: skip)
%r@    Dark red/words of Jesus

> Formatting/style-specific
%c@    Small-caps   (Style: verses-narrative-small-capitals Char font)
%s@    Small-caps   (Style: verses-narrative-small-capitals font) (none currently exist: skip)


> Styles
%no~     Normal (used on title page only)
%nv~     non-verse-content
%ni~     non-verse-content-indented
%sp~     spacer-after-prose
%sb~     spacer-before-chapter
%sf~     spacer-before-footnotes
%si~     spacer-inter-prose
%vn~     verses-narrative
%nn~     verses-non-indented-narrative
%vp~     verses-prose
%vt~     verses-title
%fn~     footnotes-normal
%ti~     Title
%ha~     Heading1
%hb~     Heading2
%hc~     Heading3 (none currently exist: skip)

Search & Replace Feature overview
-----------------------------
MS Word has some advanced search & replace features. Those ones used here are:
  o 'Find what' -->      ^?            find any/all characters
  o 'Find what' -->      ^p            find all paragraph breaks. (ASCII CR (\r). Also ^13. This is last char in paragraph)
  o 'Replace with' -->   ^&            replace with same character as find
Mixing these with the values in search & replace chart will create a special .docx file.
This is VERY destructive.

Search & Replace Instructions
-----------------------------
Follow these steps exactly. Follow these` in this order.

[1] Mark all Formatting/style-specific
    'Find what'    'Find > Format > Style'                    'Replace with'            
	   ^?           verses-narrative-small-capitals Char           %c@^&

    Example: marking the style called 'small-caps':
       o Open 'Replace' (advanced search & replace dialog)
       o Select 'more' options to lengthen dialog box
       o Focus on 'Find what' box. At bottom of dialog box, select 'Find > No Formatting'
	   o Enter '^?' (without single-quotes) in 'Find what' box
	   o Focus on 'Replace with'. At bottom of dialog box, select 'Replace > No Formatting'
	   o Enter '%c@^&' (without single quotes) in 'Replace with' box.
	   o While still focused on 'Replace with' box, 
	       move down to 'Replace' section at bottom
	   o In 'Replace' section, select 'Replace > Format > Style > verses-narrative-small-capitals Char'
	     Do not select anything else in the 'Replace' section:
		    No other styles, no formats, etc.
	   o Go back to dialog box and hit 'Replace All'

[2] Mark all characters needing formatting
    'Find what'                  'Find > Format '                                   'Replace with'
      ^?         'Find > Format > Font > Effects >  Superscript'                        %u@^&
      ^?         'Find > Format > Font > Font Style > Italic'                           %i@^&
      ^?         'Find > Format > Font > Font Color > Standard Colors > Dark Red'       %r@^&
	
    Example: marking italics:
       o Open 'Replace' (advanced search & replace dialog)
       o Select 'more' options to lengthen dialog box
       o Focus on 'Find what' box. At bottom of dialog box, select 'Find > No Formatting'
	   o Enter '^?' (without single-quotes) in 'Find what' box
	   o Focus on 'Replace with'. At bottom of dialog box, select 'Replace > No Formatting'
	   o Enter '%i@^&' (without single quotes) in 'Replace with' box.
	   o While still focused on 'Replace with' box, 
	       move down to 'Replace' section at bottom
	   o In 'Replace' section, select 'Replace > Format > Font > Font style > Italic'
	     Do not select anything else in the 'Replace' section:
		    No styles, no other formats, etc.
	   o Go back to dialog box and hit 'Replace All'

[3] Add end-of-paragraph/end-of-line markers on all lines.
    'Find what'    'Find > Format > Style'          'Replace with'            
	   ^p             Normal                             %no~^&
	   ^p             non-verse-content                  %nv~^&
	   ^p             non-verse-content-indented         %ni~^&
	   ^p             spacer-after-prose                 %sp~^&
	   ^p             spacer-before-chapter              %sb~^&
	   ^p             spacer-before-footnotes            %sf~^&
	   ^p             spacer-inter-prose                 %si~^&
	   ^p             verses-narrative                   %vn~^&
	   ^p             verses-non-indented-narrative      %nn~^&
	   ^p             verses-prose                       %vp~^&
	   ^p             verses-title                       %vt~^&
	   ^p             footnotes-normal                   %fn~^&
	   ^p             Title                              %ti~^&
	   ^p             Heading1                           %ha~^&
	   ^p             Heading2                           %hb~^&

    Example: marking Heading1 paragraphs:
       o Open 'Replace' (advanced search & replace dialog)
       o Select 'more' options to lengthen dialog box
       o Focus on 'Find what' box. At bottom of dialog box, select 'Find > No Formatting'
	   o Enter '^p' (without single-quotes) in 'Find what' box
	   o Focus on 'Replace with'. At bottom of dialog box, select 'Replace > No Formatting'
	   o Enter '%ha~^&' (without single quotes) in 'Replace with' box.
	   o While still focused on 'Replace with' box, 
	       move down to 'Replace' section at bottom
	   o In 'Replace' section, select 'Replace > Format > Style > Heading1'
	     Do not select anything else in the 'Replace' section:
		    No other styles, no formats, etc.
	   o Go back to dialog box and hit 'Replace All'

[4] Save MS Word doc changes as-is/in .docx format

[5] Save changes in a text format
       o 'Save as type' -> 'Plain Text'
       o 'Text encoding' -> 'Other encoding'. Select 'Unicode (UTF-8)'
             (Saving as 'Unicode (UTF-8)' will retain em dashes, en dashes, curly quotes, Greek words, etc.)
       o Do NOT select 'Insert line breaks'.
	   o Select 'End lines with' -> 'LF only' (this probably has no effect, however)
       o Do NOT select 'Allow character substitution'
       o Save or move file to '$GIT_ROOT\tools\intermediate' (or wherever)

Strong's Word References
------------------------
The USX 3.0 and later protocols allow for markup of the Strong's number for Greek or Hebrew words.
Usx-gen scans specially-formatted Strong's reference and conversts them to USX Strong's markups.
In the final usx version, the parenthesis, slash, and "Strong's" text are removed.

Some examples:

(ἐπιούσιος/Strong’s 1967)
(sophos/Strong's G4680)
(xyz/Strong's H1234a)

Usx-gen will recognize and properly scan these Strong's references if and only if the
following syntax rules are followed:

1) The entire reference is wrapped in parenthesis
2) There is a single word followed by a slash followed by the word "Strong's"
3) There is a single space after "Strong's"
4) There is a Strong's number reference. This can be
   (a) Optional letter "G" or "H" before number. If no letter specified, defaults to "G".
   (b) Optional small letter "a", "b", etc. after Strong's number (if it needs it).
   (c) Number of digits or whether it has leading zeros doesn't matter.
5) If there is a space after left paren or before or after slash, scan will fail.
6) If the reference is mixed character formatting (like if left paren is italics
   and the rest is not), then scan will fail.


Final Thoughts
--------------
If you run across a problem, there's a good chance that there's something misformatted in
the Word doc that needs to be fixed. Also, there's a good chance there might be a workaround
you can do, change the Word doc in some way, to get it to work. 


???
++++ deleteme ++++
%#
Put 'xxx' at end of each line (just 1 occurence at end of paragraph)
^13
xxx^&
